<!-- è¶…çº§ç®€åŒ–æµ‹è¯•ç‰ˆæœ¬ - ä¸“é—¨å®šä½ MetingJS é—®é¢˜ -->
<div style="background: #f0f8ff; border: 2px solid #4169e1; padding: 20px; margin: 20px 0; border-radius: 10px;">
  <h3 style="color: #4169e1; margin: 0 0 15px 0;">ğŸ” MetingJS ä¸“é¡¹æ£€æµ‹å™¨</h3>
  
  <div id="test-results" style="background: white; padding: 15px; border-radius: 5px; margin: 10px 0;">
    <p style="margin: 5px 0;"><strong>é¡µé¢åŠ è½½æ—¶é—´:</strong> <span id="load-time">æ£€æµ‹ä¸­...</span></p>
    <p style="margin: 5px 0;"><strong>APlayer çŠ¶æ€:</strong> <span id="aplayer-status">ğŸ”„ æ£€æµ‹ä¸­</span></p>
    <p style="margin: 5px 0;"><strong>MetingJS æ£€æµ‹:</strong> <span id="meting-status">ğŸ”„ æ£€æµ‹ä¸­</span></p>
    <p style="margin: 5px 0;"><strong>meting-js å…ƒç´ :</strong> <span id="element-status">ğŸ”„ æ£€æµ‹ä¸­</span></p>
    <p style="margin: 5px 0;"><strong>éŸ³ä¹æ’­æ”¾å™¨ç•Œé¢:</strong> <span id="player-status">ğŸ”„ æ£€æµ‹ä¸­</span></p>
  </div>

  <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0;">
    <strong>è¯¦ç»†ä¿¡æ¯:</strong>
    <div id="detailed-info" style="font-family: monospace; font-size: 12px; margin: 5px 0; max-height: 200px; overflow-y: auto;">
      æ­£åœ¨æ”¶é›†ä¿¡æ¯...<br>
    </div>
  </div>

  <div style="background: #d4edda; padding: 10px; border-radius: 5px; margin: 10px 0;">
    <strong>å…¨å±€å¯¹è±¡æ£€æµ‹:</strong>
    <div id="global-objects" style="font-family: monospace; font-size: 12px; margin: 5px 0;">
      æ£€æµ‹ä¸­...<br>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';
  
  let startTime = Date.now();
  
  function log(message) {
    const timestamp = new Date().toLocaleTimeString();
    const detailedInfo = document.getElementById('detailed-info');
    if (detailedInfo) {
      detailedInfo.innerHTML += `[${timestamp}] ${message}<br>`;
      detailedInfo.scrollTop = detailedInfo.scrollHeight;
    }
    console.log(`MetingJSæ£€æµ‹å™¨: [${timestamp}] ${message}`);
  }
  
  function updateStatus(elementId, value, isSuccess = null) {
    const element = document.getElementById(elementId);
    if (element) {
      element.textContent = value;
      if (isSuccess === true) {
        element.style.color = '#28a745';
      } else if (isSuccess === false) {
        element.style.color = '#dc3545';
      } else {
        element.style.color = '#ffc107';
      }
    }
  }
  
  function detectMetingJS() {
    log('å¼€å§‹ MetingJS ä¸“é¡¹æ£€æµ‹');
    
    // 1. é¡µé¢åŠ è½½æ—¶é—´
    const loadTime = Date.now() - startTime;
    updateStatus('load-time', `${loadTime}ms`, loadTime < 5000);
    
    // 2. æ£€æµ‹ APlayer
    if (window.APlayer) {
      updateStatus('aplayer-status', 'âœ… APlayer å¯ç”¨', true);
      log(`APlayer ç‰ˆæœ¬: ${window.APlayer.version || 'æœªçŸ¥'}`);
    } else {
      updateStatus('aplayer-status', 'âŒ APlayer ä¸å¯ç”¨', false);
      log('APlayer æœªæ‰¾åˆ°');
    }
    
    // 3. è¯¦ç»†æ£€æµ‹ MetingJS ç›¸å…³çš„å…¨å±€å¯¹è±¡
    const globalObjects = document.getElementById('global-objects');
    let globalInfo = '';
    
    const possibleMetingObjects = [
      'MetingJSElement', 'MetingJSPlugin', 'MetingJS', 'meting', 'Meting',
      'MetingElement', 'customElements'
    ];
    
    possibleMetingObjects.forEach(objName => {
      const obj = window[objName];
      if (obj) {
        globalInfo += `âœ… ${objName}: ${typeof obj}<br>`;
        log(`å‘ç°å…¨å±€å¯¹è±¡: ${objName} (${typeof obj})`);
      } else {
        globalInfo += `âŒ ${objName}: æœªå®šä¹‰<br>`;
      }
    });
    
    // æ£€æŸ¥ customElements æ³¨å†Œæƒ…å†µ
    if (window.customElements) {
      const metingJsDefined = customElements.get('meting-js');
      if (metingJsDefined) {
        globalInfo += `âœ… meting-js è‡ªå®šä¹‰å…ƒç´ å·²æ³¨å†Œ<br>`;
        log('meting-js è‡ªå®šä¹‰å…ƒç´ å·²æ³¨å†Œ');
        updateStatus('meting-status', 'âœ… MetingJS å¯ç”¨ (customElements)', true);
      } else {
        globalInfo += `âŒ meting-js è‡ªå®šä¹‰å…ƒç´ æœªæ³¨å†Œ<br>`;
        log('meting-js è‡ªå®šä¹‰å…ƒç´ æœªæ³¨å†Œ');
        updateStatus('meting-status', 'âŒ MetingJS ä¸å¯ç”¨', false);
      }
    } else {
      globalInfo += `âŒ customElements API ä¸å¯ç”¨<br>`;
      log('customElements API ä¸å¯ç”¨');
      updateStatus('meting-status', 'âŒ ä¸æ”¯æŒ customElements', false);
    }
    
    globalObjects.innerHTML = globalInfo;
    
    // 4. æ£€æµ‹ meting-js å…ƒç´ 
    const metingElements = document.querySelectorAll('meting-js');
    if (metingElements.length > 0) {
      updateStatus('element-status', `âœ… æ‰¾åˆ° ${metingElements.length} ä¸ªå…ƒç´ `, true);
      log(`æ‰¾åˆ° ${metingElements.length} ä¸ª meting-js å…ƒç´ `);
      
      // æ£€æŸ¥æ¯ä¸ªå…ƒç´ çš„å±æ€§
      metingElements.forEach((el, index) => {
        const attrs = {
          server: el.getAttribute('server'),
          type: el.getAttribute('type'),
          id: el.getAttribute('id'),
          auto: el.getAttribute('auto')
        };
        log(`å…ƒç´  ${index}: ${JSON.stringify(attrs)}`);
      });
    } else {
      updateStatus('element-status', 'âŒ æœªæ‰¾åˆ°å…ƒç´ ', false);
      log('æœªæ‰¾åˆ° meting-js å…ƒç´ ');
    }
    
    // 5. æ£€æµ‹éŸ³ä¹æ’­æ”¾å™¨ç•Œé¢
    const aplayerElements = document.querySelectorAll('.aplayer');
    if (aplayerElements.length > 0) {
      updateStatus('player-status', `âœ… æ‰¾åˆ° ${aplayerElements.length} ä¸ªæ’­æ”¾å™¨`, true);
      log(`æ‰¾åˆ° ${aplayerElements.length} ä¸ª aplayer ç•Œé¢`);
      
      // æ£€æŸ¥æ’­æ”¾å™¨çŠ¶æ€
      aplayerElements.forEach((el, index) => {
        const hasAudio = el.querySelector('audio');
        const hasPlaylist = el.querySelector('.aplayer-list');
        log(`æ’­æ”¾å™¨ ${index}: éŸ³é¢‘=${!!hasAudio}, æ’­æ”¾åˆ—è¡¨=${!!hasPlaylist}`);
      });
    } else {
      updateStatus('player-status', 'âŒ æœªæ‰¾åˆ°æ’­æ”¾å™¨ç•Œé¢', false);
      log('æœªæ‰¾åˆ° aplayer ç•Œé¢');
    }
  }
  
  // ç«‹å³æ‰§è¡Œä¸€æ¬¡
  setTimeout(detectMetingJS, 100);
  
  // 1ç§’åå†æ£€æŸ¥
  setTimeout(() => {
    log('1ç§’åé‡æ–°æ£€æµ‹');
    detectMetingJS();
  }, 1000);
  
  // 3ç§’åæœ€åæ£€æŸ¥
  setTimeout(() => {
    log('3ç§’åæœ€ç»ˆæ£€æµ‹');
    detectMetingJS();
    log('MetingJS ä¸“é¡¹æ£€æµ‹å®Œæˆ');
  }, 3000);
  
  log('MetingJS ä¸“é¡¹æ£€æµ‹å™¨å·²å¯åŠ¨');
})();
</script>
