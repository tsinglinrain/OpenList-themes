<!-- 超级简化测试版本 - 专门定位问题 -->
<div style="background: #f0f8ff; border: 2px solid #4169e1; padding: 20px; margin: 20px 0; border-radius: 10px;">
  <h3 style="color: #4169e1; margin: 0 0 15px 0;">🔍 OpenList 主题问题定位器</h3>
  
  <div id="test-results" style="background: white; padding: 15px; border-radius: 5px; margin: 10px 0;">
    <p style="margin: 5px 0;"><strong>页面加载时间:</strong> <span id="load-time">检测中...</span></p>
    <p style="margin: 5px 0;"><strong>脚本执行状态:</strong> <span id="script-status">🔄 等待执行</span></p>
    <p style="margin: 5px 0;"><strong>DOM 准备状态:</strong> <span id="dom-status">检测中...</span></p>
    <p style="margin: 5px 0;"><strong>控制台错误:</strong> <span id="console-errors">监听中...</span></p>
  </div>

  <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0;">
    <strong>测试计数器:</strong> <span id="test-counter">0</span> 
    <button onclick="manualTest()" style="margin-left: 10px; padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer;">手动测试</button>
  </div>

  <div style="background: #d4edda; padding: 10px; border-radius: 5px; margin: 10px 0;">
    <strong>实时日志:</strong>
    <div id="live-log" style="background: #2c3e50; color: #ecf0f1; padding: 10px; margin: 5px 0; border-radius: 3px; font-family: monospace; font-size: 12px; max-height: 150px; overflow-y: auto;">
      [启动] 问题定位器已加载<br>
    </div>
  </div>
</div>

<script>
// 超级简化的问题定位脚本
(function() {
  'use strict';
  
  let testCount = 0;
  let startTime = Date.now();
  let errorCount = 0;
  
  function log(message) {
    const timestamp = new Date().toLocaleTimeString();
    const logElement = document.getElementById('live-log');
    if (logElement) {
      logElement.innerHTML += `[${timestamp}] ${message}<br>`;
      logElement.scrollTop = logElement.scrollHeight;
    }
    console.log(`OpenList定位器: [${timestamp}] ${message}`);
  }
  
  function updateStatus(elementId, value, isSuccess = null) {
    const element = document.getElementById(elementId);
    if (element) {
      element.textContent = value;
      if (isSuccess === true) {
        element.style.color = '#28a745';
      } else if (isSuccess === false) {
        element.style.color = '#dc3545';
      }
    }
  }
  
  function runTest() {
    testCount++;
    updateStatus('test-counter', testCount);
    log(`执行第 ${testCount} 次测试`);
    
    // 检查页面加载时间
    const loadTime = Date.now() - startTime;
    updateStatus('load-time', `${loadTime}ms`, loadTime < 5000);
    
    // 检查 DOM 状态
    const domReady = document.readyState;
    updateStatus('dom-status', domReady, domReady === 'complete');
    log(`DOM状态: ${domReady}`);
    
    // 脚本执行状态
    updateStatus('script-status', '✅ 正常执行', true);
    log('脚本执行正常');
    
    // 检查常见的全局对象
    const checks = [
      {name: 'jQuery', obj: window.jQuery || window.$},
      {name: 'APlayer', obj: window.APlayer},
      {name: 'MetingJS', obj: window.MetingJSPlugin || window.meting},
      {name: 'location', obj: window.location}
    ];
    
    checks.forEach(({name, obj}) => {
      if (obj) {
        log(`✅ ${name} 可用`);
      } else {
        log(`❌ ${name} 不可用`);
      }
    });
    
    // 检查页面元素
    const elementChecks = [
      'openlist-theme-container',
      'test-results',
      'live-log'
    ];
    
    elementChecks.forEach(id => {
      const element = document.getElementById(id);
      if (element) {
        log(`✅ 元素 #${id} 存在`);
      } else {
        log(`❌ 元素 #${id} 不存在`);
      }
    });
  }
  
  // 手动测试函数
  window.manualTest = function() {
    log('手动测试触发');
    runTest();
  };
  
  // 错误监听
  window.addEventListener('error', function(e) {
    errorCount++;
    updateStatus('console-errors', `${errorCount} 个错误`, false);
    log(`❌ JavaScript错误: ${e.message} (${e.filename}:${e.lineno})`);
  });
  
  // 多重启动策略
  function startTesting() {
    log('开始问题定位测试');
    runTest();
    
    // 定时重复测试
    setTimeout(() => {
      log('1秒后重测');
      runTest();
    }, 1000);
    
    setTimeout(() => {
      log('3秒后重测');
      runTest();
    }, 3000);
    
    setTimeout(() => {
      log('5秒后重测');
      runTest();
    }, 5000);
  }
  
  // 立即启动
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', startTesting);
    log('等待DOM加载完成');
  } else {
    startTesting();
  }
  
  // 页面完全加载后再测试一次
  window.addEventListener('load', () => {
    log('页面完全加载完成');
    setTimeout(runTest, 500);
  });
  
  log('问题定位器初始化完成');
})();
</script>
