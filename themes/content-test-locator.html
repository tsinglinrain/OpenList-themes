<!-- è¶…çº§ç®€åŒ–æµ‹è¯•ç‰ˆæœ¬ - ä¸“é—¨å®šä½é—®é¢˜ -->
<div style="background: #f0f8ff; border: 2px solid #4169e1; padding: 20px; margin: 20px 0; border-radius: 10px;">
  <h3 style="color: #4169e1; margin: 0 0 15px 0;">ğŸ” OpenList ä¸»é¢˜é—®é¢˜å®šä½å™¨</h3>
  
  <div id="test-results" style="background: white; padding: 15px; border-radius: 5px; margin: 10px 0;">
    <p style="margin: 5px 0;"><strong>é¡µé¢åŠ è½½æ—¶é—´:</strong> <span id="load-time">æ£€æµ‹ä¸­...</span></p>
    <p style="margin: 5px 0;"><strong>è„šæœ¬æ‰§è¡ŒçŠ¶æ€:</strong> <span id="script-status">ğŸ”„ ç­‰å¾…æ‰§è¡Œ</span></p>
    <p style="margin: 5px 0;"><strong>DOM å‡†å¤‡çŠ¶æ€:</strong> <span id="dom-status">æ£€æµ‹ä¸­...</span></p>
    <p style="margin: 5px 0;"><strong>æ§åˆ¶å°é”™è¯¯:</strong> <span id="console-errors">ç›‘å¬ä¸­...</span></p>
  </div>

  <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0;">
    <strong>æµ‹è¯•è®¡æ•°å™¨:</strong> <span id="test-counter">0</span> 
    <button onclick="manualTest()" style="margin-left: 10px; padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer;">æ‰‹åŠ¨æµ‹è¯•</button>
  </div>

  <div style="background: #d4edda; padding: 10px; border-radius: 5px; margin: 10px 0;">
    <strong>å®æ—¶æ—¥å¿—:</strong>
    <div id="live-log" style="background: #2c3e50; color: #ecf0f1; padding: 10px; margin: 5px 0; border-radius: 3px; font-family: monospace; font-size: 12px; max-height: 150px; overflow-y: auto;">
      [å¯åŠ¨] é—®é¢˜å®šä½å™¨å·²åŠ è½½<br>
    </div>
  </div>
</div>

<script>
// è¶…çº§ç®€åŒ–çš„é—®é¢˜å®šä½è„šæœ¬
(function() {
  'use strict';
  
  let testCount = 0;
  let startTime = Date.now();
  let errorCount = 0;
  
  function log(message) {
    const timestamp = new Date().toLocaleTimeString();
    const logElement = document.getElementById('live-log');
    if (logElement) {
      logElement.innerHTML += `[${timestamp}] ${message}<br>`;
      logElement.scrollTop = logElement.scrollHeight;
    }
    console.log(`OpenListå®šä½å™¨: [${timestamp}] ${message}`);
  }
  
  function updateStatus(elementId, value, isSuccess = null) {
    const element = document.getElementById(elementId);
    if (element) {
      element.textContent = value;
      if (isSuccess === true) {
        element.style.color = '#28a745';
      } else if (isSuccess === false) {
        element.style.color = '#dc3545';
      }
    }
  }
  
  function runTest() {
    testCount++;
    updateStatus('test-counter', testCount);
    log(`æ‰§è¡Œç¬¬ ${testCount} æ¬¡æµ‹è¯•`);
    
    // æ£€æŸ¥é¡µé¢åŠ è½½æ—¶é—´
    const loadTime = Date.now() - startTime;
    updateStatus('load-time', `${loadTime}ms`, loadTime < 5000);
    
    // æ£€æŸ¥ DOM çŠ¶æ€
    const domReady = document.readyState;
    updateStatus('dom-status', domReady, domReady === 'complete');
    log(`DOMçŠ¶æ€: ${domReady}`);
    
    // è„šæœ¬æ‰§è¡ŒçŠ¶æ€
    updateStatus('script-status', 'âœ… æ­£å¸¸æ‰§è¡Œ', true);
    log('è„šæœ¬æ‰§è¡Œæ­£å¸¸');
    
    // æ£€æŸ¥å¸¸è§çš„å…¨å±€å¯¹è±¡
    const checks = [
      {name: 'jQuery', obj: window.jQuery || window.$},
      {name: 'APlayer', obj: window.APlayer},
      {name: 'MetingJS', obj: window.MetingJSPlugin || window.meting},
      {name: 'location', obj: window.location}
    ];
    
    checks.forEach(({name, obj}) => {
      if (obj) {
        log(`âœ… ${name} å¯ç”¨`);
      } else {
        log(`âŒ ${name} ä¸å¯ç”¨`);
      }
    });
    
    // æ£€æŸ¥é¡µé¢å…ƒç´ 
    const elementChecks = [
      'openlist-theme-container',
      'test-results',
      'live-log'
    ];
    
    elementChecks.forEach(id => {
      const element = document.getElementById(id);
      if (element) {
        log(`âœ… å…ƒç´  #${id} å­˜åœ¨`);
      } else {
        log(`âŒ å…ƒç´  #${id} ä¸å­˜åœ¨`);
      }
    });
  }
  
  // æ‰‹åŠ¨æµ‹è¯•å‡½æ•°
  window.manualTest = function() {
    log('æ‰‹åŠ¨æµ‹è¯•è§¦å‘');
    runTest();
  };
  
  // é”™è¯¯ç›‘å¬
  window.addEventListener('error', function(e) {
    errorCount++;
    updateStatus('console-errors', `${errorCount} ä¸ªé”™è¯¯`, false);
    log(`âŒ JavaScripté”™è¯¯: ${e.message} (${e.filename}:${e.lineno})`);
  });
  
  // å¤šé‡å¯åŠ¨ç­–ç•¥
  function startTesting() {
    log('å¼€å§‹é—®é¢˜å®šä½æµ‹è¯•');
    runTest();
    
    // å®šæ—¶é‡å¤æµ‹è¯•
    setTimeout(() => {
      log('1ç§’åé‡æµ‹');
      runTest();
    }, 1000);
    
    setTimeout(() => {
      log('3ç§’åé‡æµ‹');
      runTest();
    }, 3000);
    
    setTimeout(() => {
      log('5ç§’åé‡æµ‹');
      runTest();
    }, 5000);
  }
  
  // ç«‹å³å¯åŠ¨
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', startTesting);
    log('ç­‰å¾…DOMåŠ è½½å®Œæˆ');
  } else {
    startTesting();
  }
  
  // é¡µé¢å®Œå…¨åŠ è½½åå†æµ‹è¯•ä¸€æ¬¡
  window.addEventListener('load', () => {
    log('é¡µé¢å®Œå…¨åŠ è½½å®Œæˆ');
    setTimeout(runTest, 500);
  });
  
  log('é—®é¢˜å®šä½å™¨åˆå§‹åŒ–å®Œæˆ');
})();
</script>
