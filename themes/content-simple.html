<!-- OpenList 主题 - 简化版本（无延迟加载） -->
<!-- 直接显示，不使用 display:none -->

<div id="openlist-theme-simple" style="max-width: 100%; margin: 0 auto; padding: 0;">
	<!--音乐播放器-->
    <div style="margin: 10px 0;">
        <meting-js 
            list-folded="true" 
            server="{{MUSIC_SERVER}}" 
            type="playlist" 
            id="{{PLAYLIST_ID}}" 
            fixed="true"
            style="max-width: 100%;">
            <pre hidden>
                [00:00.00]This
                [00:04.01]is
                [00:08.02]Waite
            </pre>
        </meting-js>
    </div>

    <br />
    <center class="dibu">
        <div style="line-height: 20px;font-size: 9pt;font-weight: bold; max-width: 100%;">
            <span>
                "
                <span style="color: rgb(13, 109, 252); font-weight: bold;" id="hitokoto">
                    <a href="#" id="hitokoto_text">
                        "{{DEFAULT_QUOTE}}"
                    </a>
                </span> "
            </span>
            <p style="margin-left: 10rem;font-size: 8pt;">
                <small>
                    —— {{QUOTE_AUTHOR}}
                </small>
            </p>
        </div>

        <div style="font-size: 13px; font-weight: bold; max-width: 100%; word-wrap: break-word;">
            
            <span class="nav-item">
                <a class="nav-link" href="mailto:{{EMAIL}}" target="_blank">
                    <i class="fa-duotone fa-envelope-open" style="color:#409EFF" aria-hidden="true">
                    </i>
                    邮箱 |
                </a>
            </span>
            <span class="nav-item">
                <a class="nav-link" href="{{BLOG_URL}}" target="_blank">
                    <i class="fas fa-edit" style="color:#409EFF" aria-hidden="true">
                    </i>
                    博客 |
                </a>
            </span>
            
            <span class="nav-item">
                <a class="nav-link" href="{{CLOUD_URL}}" target="_blank">
                    <i class="fa fa-cloud-download" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    云盘 |
                </a>
            </span>
            <!--后台入口-->
            <span class="nav-item">
                <a class="nav-link" href="/@manage" target="_blank">
                    <i class="fa-solid fa-folder-gear" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    管理 |
                </a>
            </span>
            <!--版权，请尊重作者-->
            <span class="nav-item">
                <a class="nav-link" href="https://github.com/OpenListTeam/OpenList" target="_blank">
                    <i class="fa-solid fa-copyright" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    Openlist
                </a>
            </span>
            <br />
            <!--添加一个访问量-->
            <span style="word-wrap: break-word; max-width: 100%; display: inline-block;">
                本"<span style="color: rgb(13, 109, 252); font-weight: bold;"><a href="#">目录</a></span>"访问量 <span id="busuanzi_value_page_pv" style="color: rgb(13, 109, 252); font-weight: bold;"></span> 次 本站总访问量 <span id="busuanzi_value_site_pv" style="color: rgb(13, 109, 252); font-weight: bold;"></span>                次 本站总访客数 <span id="busuanzi_value_site_uv" style="color: rgb(13, 109, 252); font-weight: bold;"></span> 人
            </span>
            <br />
            <!--添加备案信息-->
            <span class="nav-item">
                <a class="nav-link" href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank">
                    <i class="fa-solid fa-shield-check" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    {{ICP_RECORD}}
                </a>
            </span>
        </div>
    </center>
    <br />
    <br />

    <!--评论模块-->
	<center>
		<div class="giscus" id="giscus" style="max-width: 100%; box-sizing: border-box;"></div> 
	</center>
</div>

<!--一言API-->
<script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script>

<script>
console.log("OpenList主题简化版本加载完成");

// 等待依赖加载后初始化
function initializeComponents() {
    console.log("开始初始化组件");
    
    // 检查并初始化音乐播放器
    setTimeout(() => {
        const metingElements = document.querySelectorAll('meting-js');
        console.log(`找到 ${metingElements.length} 个 meting-js 元素`);
        
        metingElements.forEach((el, index) => {
            console.log(`MetingJS 元素 ${index}:`, {
                server: el.getAttribute('server'),
                type: el.getAttribute('type'),
                id: el.getAttribute('id'),
                hasAPlayer: el.querySelector('.aplayer') !== null
            });
            
            // 如果没有播放器界面，尝试触发重新渲染
            if (!el.querySelector('.aplayer')) {
                console.log(`重新初始化 MetingJS 元素 ${index}`);
                // 强制重新渲染
                const server = el.getAttribute('server');
                el.setAttribute('server', 'temp');
                setTimeout(() => {
                    el.setAttribute('server', server);
                }, 100);
            }
        });
        
        // 检查 APlayer 和 MetingJS 的加载状态
        console.log('依赖状态检查:', {
            APlayer: typeof APlayer !== 'undefined',
            MetingJSElement: typeof MetingJSElement !== 'undefined',
            customElements: customElements.get('meting-js') !== undefined
        });
    }, 2000);
    
    // 检查 Giscus 评论系统
    setTimeout(() => {
        const giscusDiv = document.getElementById('giscus');
        if (giscusDiv) {
            const hasGiscusContent = giscusDiv.children.length > 0 && 
                                   !giscusDiv.innerHTML.includes('评论系统加载中');
            console.log('Giscus 状态:', {
                element: !!giscusDiv,
                hasContent: hasGiscusContent,
                innerHTML: giscusDiv.innerHTML.length > 20 ? '有内容' : '空或很少内容'
            });
            
            if (!hasGiscusContent) {
                console.log('⚠️ Giscus 评论系统未正确加载，尝试手动初始化');
                initializeGiscusManually();
            }
        }
    }, 3000);
}

// 手动初始化 Giscus
function initializeGiscusManually() {
    const giscusContainer = document.getElementById('giscus');
    if (!giscusContainer) {
        console.log('❌ 未找到 Giscus 容器');
        return;
    }
    
    // 从 header 中获取 Giscus 配置
    const originalScript = document.querySelector('script[src*="giscus.app/client.js"]');
    if (!originalScript) {
        console.log('❌ 未找到原始 Giscus 脚本');
        return;
    }
    
    const config = {
        repo: originalScript.getAttribute('data-repo'),
        repoId: originalScript.getAttribute('data-repo-id'),
        category: originalScript.getAttribute('data-category'),
        categoryId: originalScript.getAttribute('data-category-id')
    };
    
    console.log('🔧 手动初始化 Giscus', config);
    
    // 检查配置是否有效
    if (!config.repo || config.repo.includes('{{')) {
        console.log('❌ Giscus 配置无效或包含未替换变量');
        giscusContainer.innerHTML = '<div style="text-align: center; color: #f56565; padding: 20px;">❌ 评论系统配置错误</div>';
        return;
    }
    
    // 清空容器并重新初始化
    giscusContainer.innerHTML = '';
    
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', config.repo);
    script.setAttribute('data-repo-id', config.repoId);
    script.setAttribute('data-category', config.category);
    script.setAttribute('data-category-id', config.categoryId);
    script.setAttribute('data-mapping', 'pathname');
    script.setAttribute('data-strict', '0');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-input-position', 'bottom');
    script.setAttribute('data-theme', 'preferred_color_scheme');
    script.setAttribute('data-lang', 'zh-CN');
    script.crossOrigin = 'anonymous';
    script.async = true;
    
    script.onload = () => {
        console.log('✅ Giscus 手动初始化成功');
    };
    
    script.onerror = () => {
        console.log('❌ Giscus 手动初始化失败');
        giscusContainer.innerHTML = '<div style="text-align: center; color: #f56565; padding: 20px;">❌ 评论系统加载失败</div>';
    };
    
    giscusContainer.appendChild(script);
}

// 立即开始初始化
initializeComponents();

// DOM 加载完成后再次初始化
document.addEventListener('DOMContentLoaded', initializeComponents);

// 窗口加载完成后再次初始化
window.addEventListener('load', () => {
    setTimeout(initializeComponents, 1000);
});

function removelrc() {
    //检测是否存在歌词按钮
    if (!document.querySelector(".aplayer-icon-lrc"))
        return;
    else {
        //触发以后立刻移除监听
        document.removeEventListener("DOMNodeInserted", removelrc);
        //稍作延时保证触发函数时存在按钮
        setTimeout(function () {
            //以触发按钮的方式隐藏歌词，防止在点击显示歌词按钮时需要点击两次才能出现的问题
            document.querySelector(".aplayer-icon-lrc").click();
        }, 1);
        console.log("音乐播放器歌词已隐藏");
        return;
    }
}

document.addEventListener('DOMNodeInserted', removelrc)
</script>
