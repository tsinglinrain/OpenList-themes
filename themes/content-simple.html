<!-- OpenList ä¸»é¢˜ - ç®€åŒ–ç‰ˆæœ¬ï¼ˆæ— å»¶è¿ŸåŠ è½½ï¼‰ -->
<!-- ç›´æ¥æ˜¾ç¤ºï¼Œä¸ä½¿ç”¨ display:none -->

<div id="openlist-theme-simple" style="max-width: 100%; margin: 0 auto; padding: 0;">
	<!--éŸ³ä¹æ’­æ”¾å™¨-->
    <div style="margin: 10px 0;">
        <meting-js 
            list-folded="true" 
            server="{{MUSIC_SERVER}}" 
            type="playlist" 
            id="{{PLAYLIST_ID}}" 
            fixed="true"
            style="max-width: 100%;">
            <pre hidden>
                [00:00.00]This
                [00:04.01]is
                [00:08.02]Waite
            </pre>
        </meting-js>
    </div>

    <br />
    <center class="dibu">
        <div style="line-height: 20px;font-size: 9pt;font-weight: bold; max-width: 100%;">
            <span>
                "
                <span style="color: rgb(13, 109, 252); font-weight: bold;" id="hitokoto">
                    <a href="#" id="hitokoto_text">
                        "{{DEFAULT_QUOTE}}"
                    </a>
                </span> "
            </span>
            <p style="margin-left: 10rem;font-size: 8pt;">
                <small>
                    â€”â€” {{QUOTE_AUTHOR}}
                </small>
            </p>
        </div>

        <div style="font-size: 13px; font-weight: bold; max-width: 100%; word-wrap: break-word;">
            
            <span class="nav-item">
                <a class="nav-link" href="mailto:{{EMAIL}}" target="_blank">
                    <i class="fa-duotone fa-envelope-open" style="color:#409EFF" aria-hidden="true">
                    </i>
                    é‚®ç®± |
                </a>
            </span>
            <span class="nav-item">
                <a class="nav-link" href="{{BLOG_URL}}" target="_blank">
                    <i class="fas fa-edit" style="color:#409EFF" aria-hidden="true">
                    </i>
                    åšå®¢ |
                </a>
            </span>
            
            <span class="nav-item">
                <a class="nav-link" href="{{CLOUD_URL}}" target="_blank">
                    <i class="fa fa-cloud-download" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    äº‘ç›˜ |
                </a>
            </span>
            <!--åå°å…¥å£-->
            <span class="nav-item">
                <a class="nav-link" href="/@manage" target="_blank">
                    <i class="fa-solid fa-folder-gear" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    ç®¡ç† |
                </a>
            </span>
            <!--ç‰ˆæƒï¼Œè¯·å°Šé‡ä½œè€…-->
            <span class="nav-item">
                <a class="nav-link" href="https://github.com/OpenListTeam/OpenList" target="_blank">
                    <i class="fa-solid fa-copyright" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    Openlist
                </a>
            </span>
            <br />
            <!--æ·»åŠ ä¸€ä¸ªè®¿é—®é‡-->
            <span style="word-wrap: break-word; max-width: 100%; display: inline-block;">
                æœ¬"<span style="color: rgb(13, 109, 252); font-weight: bold;"><a href="#">ç›®å½•</a></span>"è®¿é—®é‡ <span id="busuanzi_value_page_pv" style="color: rgb(13, 109, 252); font-weight: bold;"></span> æ¬¡ æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv" style="color: rgb(13, 109, 252); font-weight: bold;"></span>                æ¬¡ æœ¬ç«™æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv" style="color: rgb(13, 109, 252); font-weight: bold;"></span> äºº
            </span>
            <br />
            <!--æ·»åŠ å¤‡æ¡ˆä¿¡æ¯-->
            <span class="nav-item">
                <a class="nav-link" href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank">
                    <i class="fa-solid fa-shield-check" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    {{ICP_RECORD}}
                </a>
            </span>
        </div>
    </center>
    <br />
    <br />

    <!--è¯„è®ºæ¨¡å—-->
	<center>
		<div class="giscus" id="giscus" style="max-width: 100%; box-sizing: border-box;"></div> 
	</center>
</div>

<!--ä¸€è¨€API-->
<script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script>

<script>
console.log("OpenListä¸»é¢˜ç®€åŒ–ç‰ˆæœ¬åŠ è½½å®Œæˆ");

// ç­‰å¾…ä¾èµ–åŠ è½½ååˆå§‹åŒ–
function initializeComponents() {
    console.log("å¼€å§‹åˆå§‹åŒ–ç»„ä»¶");
    
    // æ£€æŸ¥å¹¶åˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨
    setTimeout(() => {
        const metingElements = document.querySelectorAll('meting-js');
        console.log(`æ‰¾åˆ° ${metingElements.length} ä¸ª meting-js å…ƒç´ `);
        
        metingElements.forEach((el, index) => {
            console.log(`MetingJS å…ƒç´  ${index}:`, {
                server: el.getAttribute('server'),
                type: el.getAttribute('type'),
                id: el.getAttribute('id'),
                hasAPlayer: el.querySelector('.aplayer') !== null
            });
            
            // å¦‚æœæ²¡æœ‰æ’­æ”¾å™¨ç•Œé¢ï¼Œå°è¯•è§¦å‘é‡æ–°æ¸²æŸ“
            if (!el.querySelector('.aplayer')) {
                console.log(`é‡æ–°åˆå§‹åŒ– MetingJS å…ƒç´  ${index}`);
                // å¼ºåˆ¶é‡æ–°æ¸²æŸ“
                const server = el.getAttribute('server');
                el.setAttribute('server', 'temp');
                setTimeout(() => {
                    el.setAttribute('server', server);
                }, 100);
            }
        });
        
        // æ£€æŸ¥ APlayer å’Œ MetingJS çš„åŠ è½½çŠ¶æ€
        console.log('ä¾èµ–çŠ¶æ€æ£€æŸ¥:', {
            APlayer: typeof APlayer !== 'undefined',
            MetingJSElement: typeof MetingJSElement !== 'undefined',
            customElements: customElements.get('meting-js') !== undefined
        });
    }, 2000);
    
    // æ£€æŸ¥ Giscus è¯„è®ºç³»ç»Ÿ
    setTimeout(() => {
        const giscusDiv = document.getElementById('giscus');
        if (giscusDiv) {
            const hasGiscusContent = giscusDiv.children.length > 0 && 
                                   !giscusDiv.innerHTML.includes('è¯„è®ºç³»ç»ŸåŠ è½½ä¸­');
            console.log('Giscus çŠ¶æ€:', {
                element: !!giscusDiv,
                hasContent: hasGiscusContent,
                innerHTML: giscusDiv.innerHTML.length > 20 ? 'æœ‰å†…å®¹' : 'ç©ºæˆ–å¾ˆå°‘å†…å®¹'
            });
            
            if (!hasGiscusContent) {
                console.log('âš ï¸ Giscus è¯„è®ºç³»ç»Ÿæœªæ­£ç¡®åŠ è½½ï¼Œå°è¯•æ‰‹åŠ¨åˆå§‹åŒ–');
                initializeGiscusManually();
            }
        }
    }, 3000);
}

// æ‰‹åŠ¨åˆå§‹åŒ– Giscus
function initializeGiscusManually() {
    const giscusContainer = document.getElementById('giscus');
    if (!giscusContainer) {
        console.log('âŒ æœªæ‰¾åˆ° Giscus å®¹å™¨');
        return;
    }
    
    // ä» header ä¸­è·å– Giscus é…ç½®
    const originalScript = document.querySelector('script[src*="giscus.app/client.js"]');
    if (!originalScript) {
        console.log('âŒ æœªæ‰¾åˆ°åŸå§‹ Giscus è„šæœ¬');
        return;
    }
    
    const config = {
        repo: originalScript.getAttribute('data-repo'),
        repoId: originalScript.getAttribute('data-repo-id'),
        category: originalScript.getAttribute('data-category'),
        categoryId: originalScript.getAttribute('data-category-id')
    };
    
    console.log('ğŸ”§ æ‰‹åŠ¨åˆå§‹åŒ– Giscus', config);
    
    // æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰æ•ˆ
    if (!config.repo || config.repo.includes('{{')) {
        console.log('âŒ Giscus é…ç½®æ— æ•ˆæˆ–åŒ…å«æœªæ›¿æ¢å˜é‡');
        giscusContainer.innerHTML = '<div style="text-align: center; color: #f56565; padding: 20px;">âŒ è¯„è®ºç³»ç»Ÿé…ç½®é”™è¯¯</div>';
        return;
    }
    
    // æ¸…ç©ºå®¹å™¨å¹¶é‡æ–°åˆå§‹åŒ–
    giscusContainer.innerHTML = '';
    
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', config.repo);
    script.setAttribute('data-repo-id', config.repoId);
    script.setAttribute('data-category', config.category);
    script.setAttribute('data-category-id', config.categoryId);
    script.setAttribute('data-mapping', 'pathname');
    script.setAttribute('data-strict', '0');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-input-position', 'bottom');
    script.setAttribute('data-theme', 'preferred_color_scheme');
    script.setAttribute('data-lang', 'zh-CN');
    script.crossOrigin = 'anonymous';
    script.async = true;
    
    script.onload = () => {
        console.log('âœ… Giscus æ‰‹åŠ¨åˆå§‹åŒ–æˆåŠŸ');
    };
    
    script.onerror = () => {
        console.log('âŒ Giscus æ‰‹åŠ¨åˆå§‹åŒ–å¤±è´¥');
        giscusContainer.innerHTML = '<div style="text-align: center; color: #f56565; padding: 20px;">âŒ è¯„è®ºç³»ç»ŸåŠ è½½å¤±è´¥</div>';
    };
    
    giscusContainer.appendChild(script);
}

// ç«‹å³å¼€å§‹åˆå§‹åŒ–
initializeComponents();

// DOM åŠ è½½å®Œæˆåå†æ¬¡åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', initializeComponents);

// çª—å£åŠ è½½å®Œæˆåå†æ¬¡åˆå§‹åŒ–
window.addEventListener('load', () => {
    setTimeout(initializeComponents, 1000);
});

function removelrc() {
    //æ£€æµ‹æ˜¯å¦å­˜åœ¨æ­Œè¯æŒ‰é’®
    if (!document.querySelector(".aplayer-icon-lrc"))
        return;
    else {
        //è§¦å‘ä»¥åç«‹åˆ»ç§»é™¤ç›‘å¬
        document.removeEventListener("DOMNodeInserted", removelrc);
        //ç¨ä½œå»¶æ—¶ä¿è¯è§¦å‘å‡½æ•°æ—¶å­˜åœ¨æŒ‰é’®
        setTimeout(function () {
            //ä»¥è§¦å‘æŒ‰é’®çš„æ–¹å¼éšè—æ­Œè¯ï¼Œé˜²æ­¢åœ¨ç‚¹å‡»æ˜¾ç¤ºæ­Œè¯æŒ‰é’®æ—¶éœ€è¦ç‚¹å‡»ä¸¤æ¬¡æ‰èƒ½å‡ºç°çš„é—®é¢˜
            document.querySelector(".aplayer-icon-lrc").click();
        }, 1);
        console.log("éŸ³ä¹æ’­æ”¾å™¨æ­Œè¯å·²éšè—");
        return;
    }
}

document.addEventListener('DOMNodeInserted', removelrc)
</script>
