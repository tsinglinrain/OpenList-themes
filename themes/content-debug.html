<!-- OpenList ä¸»é¢˜ - è¯Šæ–­ç‰ˆæœ¬ -->
<div id="openlist-theme-debug" style="max-width: 100%; margin: 0 auto; padding: 0;">
    
    <!-- ä¾èµ–æ£€æŸ¥çŠ¶æ€æ˜¾ç¤º -->
    <div id="debug-status" style="background: #f0f8ff; border: 1px solid #409EFF; padding: 10px; margin: 10px 0; font-size: 12px;">
        <h4 style="color: #409EFF; margin: 0 0 10px 0;">ğŸ”§ OpenList ä¸»é¢˜è¯Šæ–­</h4>
        <div id="aplayer-status">ğŸ”„ æ£€æŸ¥ APlayer...</div>
        <div id="meting-status">ğŸ”„ æ£€æŸ¥ MetingJS...</div>
        <div id="giscus-status">ğŸ”„ æ£€æŸ¥ Giscus...</div>
        <div id="config-status" style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ccc;">
            <strong>é…ç½®æ£€æŸ¥ï¼š</strong>
            <div id="config-details" style="font-size: 11px; margin-top: 5px;"></div>
        </div>
        <div id="error-log" style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ccc; color: #d73a49; font-family: monospace; font-size: 11px; max-height: 150px; overflow-y: auto;">
            <strong>é”™è¯¯æ—¥å¿—ï¼š</strong>
            <div id="error-messages"></div>
        </div>
    </div>

	<!--éŸ³ä¹æ’­æ”¾å™¨-->
    <div style="margin: 10px 0; padding: 10px; border: 1px dashed #ccc;">
        <h4>éŸ³ä¹æ’­æ”¾å™¨æµ‹è¯•ï¼š</h4>
        <meting-js 
            list-folded="true" 
            server="{{MUSIC_SERVER}}" 
            type="playlist" 
            id="{{PLAYLIST_ID}}" 
            fixed="false"
            style="max-width: 100%;">
            <pre hidden>
                [00:00.00]This
                [00:04.01]is
                [00:08.02]Waite
            </pre>
        </meting-js>
        <div id="meting-debug" style="margin-top: 5px; font-size: 11px; color: #666;"></div>
    </div>

    <br />
    <center class="dibu">
        <div style="line-height: 20px;font-size: 9pt;font-weight: bold; max-width: 100%;">
            <span>
                "
                <span style="color: rgb(13, 109, 252); font-weight: bold;" id="hitokoto">
                    <a href="#" id="hitokoto_text">
                        "{{DEFAULT_QUOTE}}"
                    </a>
                </span> "
            </span>
            <p style="margin-left: 10rem;font-size: 8pt;">
                <small>
                    â€”â€” {{QUOTE_AUTHOR}}
                </small>
            </p>
        </div>

        <div style="font-size: 13px; font-weight: bold; max-width: 100%; word-wrap: break-word;">
            
            <span class="nav-item">
                <a class="nav-link" href="mailto:{{EMAIL}}" target="_blank">
                    <i class="fa-duotone fa-envelope-open" style="color:#409EFF" aria-hidden="true">
                    </i>
                    é‚®ç®± |
                </a>
            </span>
            <span class="nav-item">
                <a class="nav-link" href="{{BLOG_URL}}" target="_blank">
                    <i class="fas fa-edit" style="color:#409EFF" aria-hidden="true">
                    </i>
                    åšå®¢ |
                </a>
            </span>
            
            <span class="nav-item">
                <a class="nav-link" href="{{CLOUD_URL}}" target="_blank">
                    <i class="fa fa-cloud-download" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    äº‘ç›˜ |
                </a>
            </span>
            <!--åå°å…¥å£-->
            <span class="nav-item">
                <a class="nav-link" href="/@manage" target="_blank">
                    <i class="fa-solid fa-folder-gear" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    ç®¡ç† |
                </a>
            </span>
            <!--ç‰ˆæƒï¼Œè¯·å°Šé‡ä½œè€…-->
            <span class="nav-item">
                <a class="nav-link" href="https://github.com/OpenListTeam/OpenList" target="_blank">
                    <i class="fa-solid fa-copyright" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    Openlist
                </a>
            </span>
            <br />
            <!--æ·»åŠ å¤‡æ¡ˆä¿¡æ¯-->
            <span class="nav-item">
                <a class="nav-link" href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank">
                    <i class="fa-solid fa-shield-check" style="color:#409EFF;" aria-hidden="true">
                    </i>
                    {{ICP_RECORD}}
                </a>
            </span>
        </div>
    </center>
    <br />

    <!--è¯„è®ºæ¨¡å—-->
    <div style="margin: 10px 0; padding: 10px; border: 1px dashed #ccc;">
        <h4>è¯„è®ºç³»ç»Ÿæµ‹è¯•ï¼š</h4>
        <div style="font-size: 12px; margin-bottom: 10px;">
            <div>ä»“åº“: <code>{{GISCUS_REPO}}</code></div>
            <div>ä»“åº“ID: <code>{{GISCUS_REPO_ID}}</code></div>
            <div>åˆ†ç±»: <code>{{GISCUS_CATEGORY}}</code></div>
            <div>åˆ†ç±»ID: <code>{{GISCUS_CATEGORY_ID}}</code></div>
        </div>
        <center>
            <div class="giscus" id="giscus" style="max-width: 100%; box-sizing: border-box; min-height: 100px; border: 1px solid #eee; padding: 10px;">
                <div style="text-align: center; color: #666; padding: 20px;">
                    è¯„è®ºç³»ç»ŸåŠ è½½ä¸­...
                </div>
            </div>
        </center>
    </div>
</div>

<!--ä¸€è¨€API-->
<script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script>

<script>
console.log("ğŸ”§ OpenListä¸»é¢˜è¯Šæ–­ç‰ˆæœ¬å¼€å§‹åŠ è½½");

// é”™è¯¯æ—¥å¿—æ”¶é›†
const errorLog = [];

function logError(message) {
    errorLog.push(`${new Date().toLocaleTimeString()}: ${message}`);
    console.error('âŒ ' + message);
    
    // æ›´æ–°é¡µé¢ä¸Šçš„é”™è¯¯æ˜¾ç¤º
    const errorDiv = document.getElementById('error-messages');
    if (errorDiv) {
        errorDiv.innerHTML = errorLog.map(err => `<div>${err}</div>`).join('');
    }
}

function logInfo(message) {
    console.log('â„¹ï¸ ' + message);
}

// æ‰‹åŠ¨åˆå§‹åŒ– Giscus çš„å‡½æ•°
function initializeGiscus(config) {
    logInfo(`æ‰‹åŠ¨åˆå§‹åŒ– Giscus: ${JSON.stringify(config)}`);
    
    const giscusContainer = document.getElementById('giscus');
    if (!giscusContainer) {
        logError('æœªæ‰¾åˆ° Giscus å®¹å™¨å…ƒç´ ');
        return;
    }
    
    // æ¸…ç©ºå®¹å™¨
    giscusContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 10px;">æ­£åœ¨åˆå§‹åŒ–è¯„è®ºç³»ç»Ÿ...</div>';
    
    // åˆ›å»ºæ–°çš„ script å…ƒç´ æ¥é‡æ–°åˆå§‹åŒ– Giscus
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', config.repo);
    script.setAttribute('data-repo-id', config.repoId);
    script.setAttribute('data-category', config.category);
    script.setAttribute('data-category-id', config.categoryId);
    script.setAttribute('data-mapping', 'pathname');
    script.setAttribute('data-strict', '0');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-input-position', 'bottom');
    script.setAttribute('data-theme', 'preferred_color_scheme');
    script.setAttribute('data-lang', 'zh-CN');
    script.crossOrigin = 'anonymous';
    script.async = true;
    
    // æ·»åŠ åŠ è½½ç›‘å¬
    script.onload = () => {
        logInfo('Giscus é‡æ–°åŠ è½½æˆåŠŸ');
        updateStatus('giscus-status', 'âœ…', 'Giscus æ‰‹åŠ¨åˆå§‹åŒ–æˆåŠŸ');
    };
    
    script.onerror = (error) => {
        logError(`Giscus é‡æ–°åŠ è½½å¤±è´¥: ${error.message || 'Unknown error'}`);
        updateStatus('giscus-status', 'âŒ', 'Giscus æ‰‹åŠ¨åˆå§‹åŒ–å¤±è´¥');
        giscusContainer.innerHTML = '<div style="text-align: center; color: #f56565; padding: 20px;">âŒ è¯„è®ºç³»ç»ŸåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œä»“åº“é…ç½®</div>';
    };
    
    // è¶…æ—¶æ£€æŸ¥
    setTimeout(() => {
        if (giscusContainer.innerHTML.includes('æ­£åœ¨åˆå§‹åŒ–è¯„è®ºç³»ç»Ÿ')) {
            logError('Giscus åˆå§‹åŒ–è¶…æ—¶ï¼ˆ10ç§’ï¼‰');
            giscusContainer.innerHTML = '<div style="text-align: center; color: #f56565; padding: 20px;">â° è¯„è®ºç³»ç»Ÿåˆå§‹åŒ–è¶…æ—¶</div>';
        }
    }, 10000);
    
    // å°† script æ·»åŠ åˆ° giscus å®¹å™¨ä¸­
    giscusContainer.appendChild(script);
}

// è¯Šæ–­å‡½æ•°
function updateStatus(elementId, status, message) {
    const element = document.getElementById(elementId);
    if (element) {
        element.innerHTML = `${status} ${message}`;
    }
}

// æ£€æŸ¥ä¾èµ–
function checkDependencies() {
    logInfo('å¼€å§‹æ£€æŸ¥ä¾èµ–...');
    
    // æ£€æŸ¥é…ç½®å˜é‡æ›¿æ¢æƒ…å†µ
    const configCheck = {
        MUSIC_SERVER: '{{MUSIC_SERVER}}',
        PLAYLIST_ID: '{{PLAYLIST_ID}}',
        GISCUS_REPO: '{{GISCUS_REPO}}',
        EMAIL: '{{EMAIL}}'
    };
    
    const unresolved = Object.entries(configCheck).filter(([key, value]) => 
        value.includes('{{') && value.includes('}}')
    );
    
    const configDiv = document.getElementById('config-details');
    if (configDiv) {
        if (unresolved.length > 0) {
            configDiv.innerHTML = `âŒ æœªæ›¿æ¢çš„å˜é‡: ${unresolved.map(([k]) => k).join(', ')}`;
            logError(`é…ç½®å˜é‡æœªæ›¿æ¢: ${unresolved.map(([k, v]) => `${k}=${v}`).join(', ')}`);
        } else {
            configDiv.innerHTML = `âœ… æ‰€æœ‰é…ç½®å˜é‡å·²æ­£ç¡®æ›¿æ¢`;
            logInfo('é…ç½®å˜é‡æ£€æŸ¥é€šè¿‡');
        }
    }

    // æ£€æŸ¥ APlayer
    if (typeof APlayer !== 'undefined') {
        updateStatus('aplayer-status', 'âœ…', 'APlayer å·²åŠ è½½');
        logInfo('APlayer å¯ç”¨');
    } else {
        updateStatus('aplayer-status', 'âŒ', 'APlayer æœªåŠ è½½');
        logError('APlayer åº“æœªåŠ è½½ï¼Œå¯èƒ½æ˜¯ CDN é—®é¢˜');
    }

    // æ£€æŸ¥ MetingJS
    if (typeof MetingJSElement !== 'undefined' || document.querySelector('meting-js')) {
        const metingElements = document.querySelectorAll('meting-js');
        updateStatus('meting-status', 'âœ…', `MetingJS å·²åŠ è½½ (æ‰¾åˆ° ${metingElements.length} ä¸ªå…ƒç´ )`);
        logInfo(`MetingJS å¯ç”¨ï¼Œæ‰¾åˆ° ${metingElements.length} ä¸ªå…ƒç´ `);
        
        // æ£€æŸ¥ meting-js å…ƒç´ çš„çŠ¶æ€
        metingElements.forEach((el, index) => {
            const elementInfo = {
                server: el.getAttribute('server'),
                type: el.getAttribute('type'),
                id: el.getAttribute('id'),
                hasPlayer: el.querySelector('.aplayer') !== null
            };
            logInfo(`MetingJS å…ƒç´  ${index}: ${JSON.stringify(elementInfo)}`);
            
            if (!elementInfo.hasPlayer) {
                logError(`MetingJS å…ƒç´  ${index} æ²¡æœ‰ç”Ÿæˆæ’­æ”¾å™¨ç•Œé¢`);
            }
            
            if (elementInfo.server?.includes('{{') || elementInfo.id?.includes('{{')) {
                logError(`MetingJS å…ƒç´  ${index} åŒ…å«æœªæ›¿æ¢çš„é…ç½®å˜é‡`);
            }
        });
    } else {
        updateStatus('meting-status', 'âŒ', 'MetingJS æœªåŠ è½½');
        logError('MetingJS åº“æœªåŠ è½½æˆ–å…ƒç´ æœªæ‰¾åˆ°');
    }

    // æ£€æŸ¥ Giscus
    const giscusScript = document.querySelector('script[src*="giscus"]');
    if (giscusScript) {
        updateStatus('giscus-status', 'âœ…', 'Giscus è„šæœ¬å·²åŠ è½½');
        console.log('âœ… Giscus è„šæœ¬å­˜åœ¨');
        
        // æ£€æŸ¥ Giscus é…ç½®
        const giscusConfig = {
            repo: giscusScript.getAttribute('data-repo'),
            repoId: giscusScript.getAttribute('data-repo-id'),
            category: giscusScript.getAttribute('data-category'),
            categoryId: giscusScript.getAttribute('data-category-id')
        };
        logInfo(`Giscus é…ç½®: ${JSON.stringify(giscusConfig)}`);
        
        // æ£€æŸ¥é…ç½®æ˜¯å¦è¿˜æœ‰å˜é‡å ä½ç¬¦
        const hasPlaceholders = Object.values(giscusConfig).some(val => 
            val && val.includes('{{') && val.includes('}}')
        );
        
        if (hasPlaceholders) {
            updateStatus('giscus-status', 'âš ï¸', 'Giscus é…ç½®ä¸­è¿˜æœ‰æœªæ›¿æ¢çš„å˜é‡');
            logError('Giscus é…ç½®ä¸­å‘ç°æœªæ›¿æ¢å˜é‡');
            const unresolvedVars = Object.entries(giscusConfig)
                .filter(([k, v]) => v && v.includes('{{'))
                .map(([k, v]) => `${k}=${v}`);
            logError(`æœªæ›¿æ¢çš„ Giscus å˜é‡: ${unresolvedVars.join(', ')}`);
        } else if (!giscusConfig.repo || !giscusConfig.repoId) {
            updateStatus('giscus-status', 'âŒ', 'Giscus é…ç½®ä¸å®Œæ•´');
            logError('Giscus é…ç½®ä¸å®Œæ•´ï¼Œç¼ºå°‘å¿…è¦å‚æ•°');
        } else {
            updateStatus('giscus-status', 'âœ…', 'Giscus è„šæœ¬å·²åŠ è½½ï¼Œé…ç½®æ­£ç¡®');
            logInfo('Giscus è„šæœ¬å­˜åœ¨ä¸”é…ç½®æ­£ç¡®');
            // æ‰‹åŠ¨åˆå§‹åŒ– Giscus
            setTimeout(() => {
                initializeGiscus(giscusConfig);
            }, 1000);
        }
    } else {
        updateStatus('giscus-status', 'âŒ', 'Giscus è„šæœ¬æœªæ‰¾åˆ°');
        logError('Giscus è„šæœ¬æœªæ‰¾åˆ°ï¼Œå¯èƒ½æ˜¯ header.html æœªæ­£ç¡®åŠ è½½');
    }
}

// ç«‹å³æ£€æŸ¥ä¸€æ¬¡
setTimeout(checkDependencies, 1000);

// 2ç§’åå†æ£€æŸ¥ä¸€æ¬¡  
setTimeout(() => {
    checkDependencies();
    console.log('ğŸ”§ ç¬¬äºŒæ¬¡ä¾èµ–æ£€æŸ¥å®Œæˆ');
}, 2000);

// 5ç§’åæœ€åæ£€æŸ¥ä¸€æ¬¡
setTimeout(() => {
    checkDependencies();
    console.log('ğŸ”§ è¯Šæ–­å®Œæˆ');
    
    // å¼ºåˆ¶æ›´æ–°æ‰€æœ‰çŠ¶æ€ä¸ºæœ€ç»ˆç»“æœ
    const statusElements = ['aplayer-status', 'meting-status', 'giscus-status'];
    statusElements.forEach(id => {
        const element = document.getElementById(id);
        if (element && element.innerHTML.includes('ğŸ”„')) {
            updateStatus(id, 'âš ï¸', 'æ£€æŸ¥è¶…æ—¶');
        }
    });
    
    // å¦‚æœéŸ³ä¹æ’­æ”¾å™¨è¿˜æ˜¯æ²¡æœ‰å†…å®¹ï¼Œå°è¯•æ‰‹åŠ¨åˆå§‹åŒ–
    const metingElements = document.querySelectorAll('meting-js');
    metingElements.forEach((el, index) => {
        if (!el.querySelector('.aplayer')) {
            console.log(`å°è¯•æ‰‹åŠ¨åˆå§‹åŒ– MetingJS å…ƒç´  ${index}`);
            // å¼ºåˆ¶é‡æ–°æ¸²æŸ“
            const server = el.getAttribute('server');
            const type = el.getAttribute('type');
            const id = el.getAttribute('id');
            
            // é‡ç½®å±æ€§è§¦å‘é‡æ–°æ¸²æŸ“
            el.setAttribute('server', 'temp');
            setTimeout(() => {
                el.setAttribute('server', server);
                el.setAttribute('type', type);
                el.setAttribute('id', id);
            }, 100);
        }
    });
}, 5000);

function removelrc() {
    if (!document.querySelector(".aplayer-icon-lrc"))
        return;
    else {
        document.removeEventListener("DOMNodeInserted", removelrc);
        setTimeout(function () {
            document.querySelector(".aplayer-icon-lrc").click();
        }, 1);
        console.log("éŸ³ä¹æ’­æ”¾å™¨æ­Œè¯å·²éšè—");
        return;
    }
}

document.addEventListener('DOMNodeInserted', removelrc)
</script>